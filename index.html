<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src='http://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js'></script>
    <link rel='stylesheet prefetch' href='http://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/style.css">
    
    <title>One Power 產生器</title>
  </head>
  <body>
  
<div class="container">
  <div class="page-header">
    <h1>ONE Power 產生器</h1>
  </div>
  <div class="row">
    <div class="col-xs-9">
      <canvas id="myCanvas" width="800px" height="380px"></canvas>
    </div>
    <div id="wrap" class="col-xs-3">
      <h3>參數</h3>
      <div class="form-group row">
        <label>標題
          <input id="title" type="text" value="ONE" class="form-control"/>
        </label>
        <label>副標題
          <input id="subtitle" type="text" value="TAIWAN" class="form-control"/>
        </label>
        <label>文字(大)
          <input id="big" type="text" value="台灣" class="form-control"/>
        </label>
        <label>文字(小)
          <input id="word" type="text" value="就是力量。" class="form-control"/>
        </label>
      </div>
      <div class="row">
        <input id="btn" type="button" value="產生" class="btn btn-success"/>
        <input id="download" type="button" value="下載" class="btn btn-info"/>
      </div>
    </div>
    <div id="preload" style="font-family: 'Open Sans';"></div>
  </div>
</div>

  </body>
  <script>
  
$(function(){
  var img = new Image();
  img.onload = function(){
    console.log('loaded');
    draw();
  }
  img.setAttribute('crossOrigin', 'anonymous');
  img.src = 'images/colordot.jpg';
  var canvas = document.getElementById("myCanvas");
  var ctx = canvas.getContext("2d");
  $('#btn').click(function(){
    draw();
  });
  $('#download').click(function(){
    downloadCanvas(this, 'myCanvas', 'one power.png');
  });
  function draw(){
    var title = $('#title').val();
    var subtitle = $('#subtitle').val();
    var big = $('#big').val();
    var word = $('#word').val();
    ctx.clearRect(0,0,800,500);
    var size1 = title.length<3?168:Math.floor(500/title.length)
    var size2 = subtitle.length<6?50:Math.floor(300/subtitle.length)
    var size3 = Math.floor(48+48/big.length)
    var size4 = word.length<5?52:Math.floor(32+100/word.length)
    ctx.font = "900 "+size1+"px 'Open Sans'";
    ctx.textAlign='center';
    ctx.fillText(title,220,150+size1/2);
    ctx.globalCompositeOperation = 'source-in';
    ctx.drawImage(img,-10,20,520,360);
    ctx.globalCompositeOperation = 'source-over';
    ctx.font = "400 "+size2+"px 'Open Sans'";
    ctx.fillText(subtitle,220,150+size1/2+size2);
    ctx.fillStyle="#333";
    ctx.fillRect(420.2,180-size1/2,1.6,size1+size2-20);
    ctx.textAlign='left';
    ctx.font = "400 "+size3+"px 'Open Sans'";
    ctx.fillStyle="black";
    ctx.fillText(big,450,250-size1/2);
    ctx.font = "400 "+size4+"px 'Open Sans'";
    ctx.fillText(word,450,310-size1/2);
  }
  function downloadCanvas(link, canvasID, filename) {
    link.href = document.getElementById(canvasID).toDataURL();
    link.download = filename;
  }
});

  </script>
</html>
